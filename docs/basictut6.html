<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PyPO User Manual: Optimising reflector/group configurations in PyPO</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PyPO User Manual
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('basictut6.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Optimising reflector/group configurations in PyPO </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="basictut6_intro"></a>
Introduction</h1>
<p>The original purpose of <code>PyPO</code> was to perform ray-traces through optical systems onto a terminal planar surface, in order to optimise their configuration, and then characterise the configuration using physical optics. The optimisation was originally not part of <code>PyPO</code>: this was taken care of in external scripts. However, we realised that it is actually quite convenient to have a more general optical system optimiser built into <code>PyPO</code> and on this page we will explain the basic principles and workflow behind optimising optical systems using <code>PyPO</code>.</p>
<h1><a class="anchor" id="basictut6_overview"></a>
Global overview of optimising using PyPO</h1>
<p>Here we give a global overview of how an optimisation works in <code>PyPO</code>. For every part, we will go into more detail in the following sections. This is just to provide a comprehensive overview. First, an &lt; b&gt;initial ray-trace frame&lt; /b&gt; needs to be defined. Secondly, the &lt; b&gt;reflector or group that is to be optimised&lt; /b&gt; needs to be selected. Also, a &lt; b&gt;terminating planar surface&lt; /b&gt; needs to be created. In the case of a single reflector, the initial frame will first be propagated onto the reflector and then onto the terminating surface. For a group, the propagation will be performed in the order of insertion. So, for example, if two reflectors were placed in the group earlier, the propagation will go in the order in which the reflectors were supplied to the <code>System.groupElements()</code> method. After the propagations between group elements has been performed, the final propagation is again in the terminating surface. The next component in the optimisation is the &lt; b&gt;cost function&lt; /b&gt;. This is a user-defined function that takes as input, at minimum, the ray-trace frame evaluated on the terminal planar surface where the ray-trace frame co-ordinates or directions are used to assign a score to the configuration of the optical system through which the ray-trace was performed. Note that the cost function does purely that: assign a user-defined score metric to the ray-trace frame, using the ray positions and directions. Then, the optimiser in <code>PyPO</code> uses the differential evolution algorithm to optimise the configuration of the optical system.</p>
<h1><a class="anchor" id="basictut6_optsystem"></a>
Conventions regarding optimisiation of a configuration</h1>
<p>The optimiser accepts a reflector or a group. In case of a single reflector, the ray-trace order is as such:</p><ul>
<li>initial frame -&gt; reflector</li>
<li>reflector -&gt; terminating surface</li>
</ul>
<p>For a group, the order is defined by insertion.</p>
<p>Before optimisation, <code>PyPO</code> makes a copy of the element or group and uses that for optimising. In this way, the actual optical system is untouched during the optimisation. The translational and rotational degrees-of-freedom (DoFs) are supplied using enum datatypes. Translations and rotations are relative to the <code>pos</code> and <code>ori</code> parameters of the element or group. The pivot can be supplied, and defaults to the <code>pos</code> parameter of the element or group if not supplied.</p>
<h1><a class="anchor" id="basictut6_costfunc"></a>
The cost function</h1>
<p>An essential part of optimisation is the definition of an appropriate cost function. In <code>PyPO</code>, a cost function is defined by a user as a regular Python function which must contain at least the ray-trace frame propagated onto the terminating plane as argument.The optimiser in <code>PyPO</code> will anticipate this and pass this to the cost function. Note that other arguments are allowed, such as functions or other data. These must be passed before calling the optimiser, using the <code>partial</code> method from the <code>functools</code> package For example, if the <code>System.calcRTtilt</code> method is required, this can be defined as an argument to the cost function, and supplied before the optimisation using <code>partial</code>.</p>
<p>section basictut6_call Calling the PyPO optimiser The optimiser in <code>PyPO</code> can be called as a method of <code>System</code>. It expects the following arguments:</p><ul>
<li>The initial frame</li>
<li>The reflector or group to be optimised</li>
<li>The terminating surface</li>
<li>A list of DoFs</li>
<li>The pivot (optional, only relevant if rotational DoFs are used)</li>
<li>The (partially filled) cost function handle </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
